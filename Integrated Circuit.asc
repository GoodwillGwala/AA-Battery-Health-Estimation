Version 4
SHEET 1 1308 820
WIRE 272 -160 112 -160
WIRE 352 -160 272 -160
WIRE 112 -96 112 -160
WIRE 352 -96 352 -160
WIRE 224 -80 112 -80
WIRE -64 -64 -80 -64
WIRE -64 -32 -64 -64
WIRE -96 -16 -240 -16
WIRE 64 0 64 -16
WIRE 64 0 -32 0
WIRE 224 0 224 -16
WIRE 224 0 112 0
WIRE -96 16 -128 16
WIRE -64 64 -64 32
WIRE -240 128 -240 -16
WIRE 112 128 112 0
WIRE 112 128 -240 128
WIRE 112 176 112 128
WIRE -192 288 -208 288
WIRE -96 288 -112 288
WIRE -192 432 -208 432
WIRE -96 432 -96 416
WIRE -96 432 -112 432
FLAG -64 -64 Vcc
FLAG -128 16 In
IOPIN -128 16 In
FLAG -96 432 Vcc
FLAG -208 432 0
FLAG 112 256 0
FLAG -208 288 0
FLAG -96 288 In
FLAG -64 64 0
FLAG 112 128 Shunt
IOPIN 112 128 BiDir
FLAG 272 -160 load
SYMBOL Opamps\\opamp2 -64 -64 R0
WINDOW 3 -173 110 Left 1
SYMATTR Value LMx58_LM2904
SYMATTR InstName LM358
SYMBOL voltage -96 432 R90
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value 9
SYMBOL nmos 64 -96 R0
SYMATTR InstName M1
SYMATTR Value IRF530
SYMBOL res 96 160 R0
SYMATTR InstName R3
SYMATTR Value 1
SYMATTR SpiceLine tol=1 pwr=0.1
SYMBOL voltage -96 288 R90
WINDOW 123 47 36 VRight 2
WINDOW 39 0 0 Left 0
WINDOW 3 66 92 VRight 2
SYMATTR Value2 AC 0.1 0
SYMATTR Value 0.2
SYMATTR InstName V4
SYMBOL diode 240 -16 R180
WINDOW 0 -33 44 Left 2
WINDOW 3 -23 21 Left 2
SYMATTR InstName D1
SYMBOL BatteryModel 352 -64 R270
WINDOW 39 -306 162 VTop 1
WINDOW 0 -42 1 VTop 2
SYMATTR SpiceLine Initial_SOC=I_SOC Capacity=capacity  ESR = Internal_Resistance
SYMATTR InstName Battery
TEXT 344 -288 Center 7 ;BATTERY TESTOR V1.0
TEXT 272 368 Left 2 ;.ac dec 101 1 1500K
TEXT -224 104 Left 2 !.inc LMx58_LM2904_AI.CIR
TEXT 272 440 Left 2 !.tran 100k
TEXT 272 264 Left 2 !.step param I_SOC list 1 0.9 0.8 0.7 0.6 0.5 0.4 0.3 0.2 0.1 0.0\n.param capacity = 2.4\n.param Internal_Resistance=0.3
TEXT 272 400 Left 2 !.meas AC Impedance PARAM V(load)/I(R3)
TEXT -232 240 Left 2 ;AC Input
TEXT -232 384 Left 2 ;Power Supply
TEXT -240 208 Left 2 ;CIRCUIT INPUTS
RECTANGLE Normal 1008 512 -288 -240 2
RECTANGLE Normal 992 496 256 160 2
RECTANGLE Normal -32 496 -272 192 2
